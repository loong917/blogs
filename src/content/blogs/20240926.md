---
id: 20240926
title: 正则表达式
date: 2024年9月26日
image: programming.svg
tags: ["programming"]
---


# 目录

- 元字符
- 贪婪、非贪婪与独占模式


### 元字符

元字符指的是在正则表达式中具有特殊意义的专用字符。元字符是构成正则表达式的基本元件，正则表达式就是由一系列的元字符组成的。

- 特殊单字符

| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*标识* | *含义*                   |
| ------------------------------------------------------------------------------ | ------------------------ |
| .                                                                              | 任意字符（换行除外）     |
| \d                                                                             | 任意数字                 |
| \D                                                                             | 任意非数字               |
| \w                                                                             | 任意字母、数字及下划线   |
| \W                                                                             | 任意非字母、数字及下划线 |
| \s                                                                             | 任意空白符               |
| \S                                                                             | 任意非空白符             |

- 空白符

| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*标识* | *含义*     |
| ------------------------------------------------------------------------------ | ---------- |
| \r                                                                             | 回车符     |
| \n                                                                             | 换行符     |
| \f                                                                             | 换页符     |
| \t                                                                             | 水平制表符 |
| \v                                                                             | 垂直制表符 |
| \s                                                                             | 任意空白符 |

平时使用正则表达式时，大部分场景使用 \s 就可以满足需求。

在计算机还没有出现之前，有一种叫做电传打字机（Teletype Model 33）的机械打字机，每秒钟可以打10个字符。但是它有一个问题，就是打完一行换行的时候，要用去0.2秒，正好可以打两个字符。要是在这0.2秒里面，又有新的字符传过来，那么这个字符将丢失。于是，研制人员想了个办法解决这个问题，就是在每行后面加两个表示结束的字符。一个叫做"回车"，告诉打字机把打印头定位在左边界，不卷动滚筒；另一个叫做"换行"，告诉打字机把滚筒卷一格，不改变水平位置。这就是"换行"(\n)和"回车"(\r)的由来。

换页符（\f）是一种控制字符，用于在打印或显示输出时将当前页面清空，并开始新的页面。‌换页符的作用是让打印设备或终端在输出内容之前，将整个屏幕或页面清空，然后继续输出接下来的内容，给人一种页面切换的效果。‌换页符的使用效果主要取决于其使用的环境。在打印环境中，换页符会将打印机的当前页面清空，并开始新的页面输出。而在终端或控制台中，换页符会将终端屏幕清空，然后输出接下来的内容。


- 量词

无论是"特殊单字符"，还是"空白符"，它们都只能匹配单个字符。如果需要匹配单个字符，或者某个部分"重复N次"，或者"至少出现一次"等等，就需要用到表示量词的元字符。

| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*标识* | *含义*  |
| ------------------------------------------------------------------------------ | ------- |
| *                                                                              | 0到多次 |
| +                                                                              | 1到多次 |
| ?                                                                              | 0到1次  |
| m                                                                              | m次     |
| {m,}                                                                           | 至少m次 |
| {m,n}                                                                          | m到n次  |


- 范围

| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*标识* | *含义*                           |
| ------------------------------------------------------------------------------ | -------------------------------- |
| \|                                                                             | 或，如 a\|b 代表a 或 b           |
| [...]                                                                          | 多选一，匹配括号中任意单个元素   |
| [a-z]                                                                          | 匹配 a 到 z 之间任意单个元素     |
| [^...]                                                                         | 取反，不能是括号中的任意单个元素 |


中括号[]代表多选一，可以表示里面的任意单个字符，所以任意元音字母可以用 [aeiou] 来表示。

中括号中，我们还可以用中划线表示范围，比如 [a-z] 可以表示所有小写字母。

如果中括号第一个是脱字符（^），那么就表示非，表达的是不能是里面的任何单个元素。

比如资源可能以 http:// 开头，或者 https:// 开头，也可能以 ftp:// 开头，那么资源的协议部分，可以使用 (https?|ftp)\:\// 来表示。

![正则表达式元字符](/20240926正则表达式元字符.jpg)

### 贪婪、非贪婪与独占模式

- 贪婪匹配
  
  尽可能进行最大长度匹配。表示次数的量词，默认是贪婪的，默认尽可能多地去匹配。

- 非贪婪匹配

  尽可能进行最短匹配。"量词"元字符后加 ? , 是非贪婪的，尽可能最短地去匹配。

![正则表达式贪婪模式与非贪婪模式](/20240926正则表达式贪婪模式与非贪婪模式.jpg)

左边的示例中，不加问号时正则是贪婪匹配，匹配上了从第一个引号到最后一个引号之间的所有内容；

右边的示例中，加问号时正则是非贪婪匹配，找到了最短长度的符合要求的内容；

- 独占模式

  不管是贪婪模式，还是非贪婪模式，都需要发生回溯才能完成相应的功能。
  
  贪婪模式下的回溯，比如 regex = "xy{1,3}z" text = "xyyz", 在匹配时，y{1,3}会尽可能长地去匹配，当匹配完 xyy 后，由于 y 要尽可能匹配最长，即三个，但字符串中后面是个 z 就会导致匹配不上，这时候正则就会向前回溯，吐出当前字符 z，接着用正则中的 z 去匹配，匹配成功。

  非贪婪模式下的回溯，比如 regex = "xy{1,3}?z" text = "xyyz", 在匹配时， 由于 y{1,3}? 代表匹配 1 到 3 个 y，尽可能少地匹配。匹配上一个 y 之后，也就是在匹配上 text 中的 xy 后，正则会使用 z 和 text 中的 xy 后面的 y 比较，发现正则 z 和 y 不匹配，这时正则就会向前回溯，重新查看 y 匹配两个的情况，匹配上正则中的 xyy，然后再用 z 去匹配 text 中的 z，匹配成功。
  
  但是在一些场景下，我们不需要回溯，匹配不上返回失败就好了，因此正则中还有另外一种模式，独占模式，它类似贪婪匹配，但匹配过程不会发生回溯，因此在一些场合下性能会更好。
  独占模式会尽可能多地去匹配，如果匹配失败就结束，不会进行回溯，具体的方法就是在量词后面加上加号（+）。比如 regex = "xy{1,3}+yz" text = "xyyz", y{1,3}+尽可能多地匹配了两个 y , 不回溯导致正则 z 前面的 y 匹配不上。


### 正则表达式流程

无论用正则表达式解决什么问题，都能遵循下面的流程去走。

第⼀步，做分解。

拿到一个问题后，我们要先思考：这个问题可以分为几个子问题？每个子问题是否独立？我们拿最常见的电子邮件地址匹配来说。从文本结构来看，它可以分为"username + @ + domain name"这三个独立的部分。怎么画呢？我们可以先画出逻辑结构图。通过这个过程来厘清思路。

第⼆步，分析各个子问题。

某个位置上可能有多个字符？那就用字符组。某个位置上可能有多个字符串？那就用多选结构。出现的次数不确定？那就用量词。对出现的位置有要求？那就用锚点锁定位置…… 某种程度上，每个问题都有对应的解法，只要熟练掌握了，知道什么时候用字符组，什么时候用多选结构，什么时候用量词，什么时候用锚点，就很容易搭建起完整的概念模型。

第三步，套皮。 

学习正则表达式时,真正重要的是字符组、多选结构、量词等等这些概念。一旦你的概念模型清楚了，写出正则表达式就非常简单了，无非是查阅语法手册，把之前得到的概念模型按照对应语言或工具的约定写下来而已。

第四步，调试。

复杂⼀点的正则表达式不能⼀次写对，这是很正常的。与其纠结“这个正则表达式看起来这么复杂，此处到底要用星号 * 还是加号 + ，不如先搞清楚，星号 * 或加号 + 限定的到底是正则表达式中的哪一部分，对应要匹配文本中的哪一部分。这两个问题搞清楚了，整个问题就迎刃而解了。